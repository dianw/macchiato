"use strict";!function(){angular.module("es",["angular-loading-bar","ngSanitize","restangular","ui.bootstrap","ui.router"])}(),function(){angular.module("es").controller("ContactFormCtrl",["$state","$stateParams","RestContactService",function(a,t,e){function r(){e.one(t.id).get().then(function(a){a.phone=Number(a.phone),o.contact=a})}function n(t){t.id?t.put().then(function(){a.go("contact-list")}):e.post(t).then(function(){a.go("contact-list")})}var o=this;o.contact={},o.load=r,o.save=n,"+"!==t.id&&r()}])}(),function(){angular.module("es").controller("ContactListCtrl",["$location","RestContactService",function(a,t){function e(){o.searchParams.hash++,o.searchParams.page=o.currentPage-1,delete o.searchParams.offset,a.search(o.searchParams),o.searchParams.offset=o.searchParams.max*o.searchParams.page,t.getList(o.searchParams).then(function(a){o.contacts=a,a.forEach(r)})}function r(a){a.one("groups").getList().then(function(t){a.groups=t})}function n(a){var t=window.confirm("Delete contacts?");t&&a.remove().then(function(){e()})}var o=this;o["delete"]=n,o.search=e,o.searchParams=a.search(),o.searchParams.hash=0,o.searchParams.page=_.defaultTo(o.searchParams.page,0),o.searchParams.max=_.defaultTo(o.searchParams.max,10),o.currentPage=_.defaultTo(o.currentPage,o.searchParams.page+1),e()}])}(),function(){angular.module("es").config(["$stateProvider",function(a){a.state("contact-list",{url:"/backend/contacts",controller:"ContactListCtrl as ctrl",templateUrl:"app/contact/contact.list.html"}).state("contact-form",{url:"/backend/contacts/:id",controller:"ContactFormCtrl as ctrl",templateUrl:"app/contact/contact.form.html"})}])}(),function(){angular.module("es").factory("RestContactService",["Restangular",function(a){return a.service("contacts")}])}(),function(){angular.module("es").controller("GroupContactListCtrl",["$location","$stateParams","RestContactService","RestGroupService",function(a,t,e,r){function n(a,t){a.post("contacts",t).then(function(){i.contact=null,s(a)},function(){i.contact=null})}function o(a){return e.getList({max:5,q:a})}function c(){return r.one(t.id).get().then(function(a){i.group=a,s(a)})}function s(t){i.searchParams.hash++,i.searchParams.page=i.currentPage-1,delete i.searchParams.offset,a.search(i.searchParams),i.searchParams.offset=i.searchParams.max*i.searchParams.page,t.getList("contacts",i.searchParams).then(function(a){t.contacts=a})}function u(a,t){var e=window.confirm("Remove "+t.name+"?");e&&a.one("contacts",t.id).remove().then(function(){s(a)})}var i=this;i.addContact=n,i.removeContact=u,i.search=s,i.searchContacts=o,i.searchParams=a.search(),i.searchParams.hash=0,i.searchParams.page=_.defaultTo(i.searchParams.page,0),i.searchParams.max=_.defaultTo(i.searchParams.max,10),i.currentPage=_.defaultTo(i.currentPage,i.searchParams.page+1),c()}])}(),function(){angular.module("es").controller("GroupFormCtrl",["$state","$stateParams","RestGroupService",function(a,t,e){function r(){e.one(t.id).get().then(function(a){o.group=a})}function n(t){t.id?t.put().then(function(){a.go("group-list")}):e.post(t).then(function(){a.go("group-list")})}var o=this;o.group={},o.load=r,o.save=n,"+"!==t.id&&r()}])}(),function(){angular.module("es").controller("GroupListCtrl",["$location","RestGroupService",function(a,t){function e(){o.searchParams.hash++,o.searchParams.page=o.currentPage-1,delete o.searchParams.offset,a.search(o.searchParams),o.searchParams.offset=o.searchParams.max*o.searchParams.page,t.getList(o.searchParams).then(function(a){o.groups=a,a.forEach(r)})}function r(a){a.getList("contacts",{max:0}).then(function(t){a.contacts=t})}function n(a){var t=window.confirm("Delete groups?");t&&a.remove().then(function(){e()})}var o=this;o["delete"]=n,o.search=e,o.searchParams=a.search(),o.searchParams.hash=0,o.searchParams.page=_.defaultTo(o.searchParams.page,0),o.searchParams.max=_.defaultTo(o.searchParams.max,10),o.currentPage=_.defaultTo(o.currentPage,o.searchParams.page+1),e()}])}(),function(){angular.module("es").config(["$stateProvider",function(a){a.state("group-list",{url:"/backend/groups",controller:"GroupListCtrl as ctrl",templateUrl:"app/group/group.list.html"}).state("group-form",{url:"/backend/groups/:id",controller:"GroupFormCtrl as ctrl",templateUrl:"app/group/group.form.html"}).state("group-contact-list",{url:"/backend/groups/:id/contacts?q",controller:"GroupContactListCtrl as ctrl",templateUrl:"app/group/group.contact.list.html"})}])}(),function(){angular.module("es").factory("RestGroupService",["Restangular",function(a){return a.service("groups")}])}(),function(){angular.module("es").config(["$httpProvider","RestangularProvider",function(a,t){t.setBaseUrl("/api"),t.setDefaultHttpFields({cache:!1}),t.addResponseInterceptor(function(a,t){var e;return"getList"===t&&angular.isObject(a)&&!angular.isArray(a)?(e=angular.copy(a.rows,e),delete a.rows,e.meta=a):e=a,e})}])}(),function(){function a(a,t,e){a.html5Mode(!0).hashPrefix("!"),t.otherwise("/backend/contacts"),e.strictMode(!1)}a.$inject=["$locationProvider","$urlRouterProvider","$urlMatcherFactoryProvider"],angular.module("es").config(a)}();